<!-- Cart Nav module -->
<div class="righ_nav_header">
    <!--span class="material-icons">receipt</span>Nueva -->

    <div class="btn-group dopdown">
        <button id="" m_id="{{{m_id}}}" m_t_id="{{{m_t_id}}}" m_t_name="{{{m_t_name}}}" type="button"
            class="dropdown-toggle  select-btn btn xl btn-more  dropdown-toggle btn-primary text" data-toggle="dropdown"
            aria-expanded="true">
            {{#each ws_left_nav_data.m_t}}
                {{#ifEquals m_t_url ../board_type_name }}
                <span class="material-icons">{{m_t_icon}}</span>
                <span class="this_m_t_name">{{m_t_name}}</span>
                {{/ifEquals}}
            {{/each}}
            <i class="material-icons">expand_more</i>
        </button>
        <ul class="dropdown-menu pull-left">
            {{#each ws_left_nav_data.m_t}}
            <li class="margin-5">
                <a class="" onclick="get_module_type_nav(this)" m_id="{{{m_id}}}" m_t_id="{{{m_t_id}}}"
                    s_url_t_m="{{{../module_name}}}" m_t_url="{{{m_t_url}}}" href="#">
                    <span class="material-icons">{{m_t_icon}}</span>
                    <span class="this_m_t_name">{{m_t_name}}</span>
                </a>
            </li>
            {{/each}}
        </ul>
    </div>
    <button id="" type="button" class="left_nav_close btn btn-default right_nav_close pull-right ">
        <span class="material-icons">close</span>
    </button>
</div>

<!-- Contact module -->
<div class="righ_nav_users search-box padding-0 col-xs-12 col-sm-12 col-md-12 col-lg-12">

    <div class="padding-0 col-xs-2 col-sm-2 col-md-2 col-lg-2">
        <button onclick="add_new_contact(this)" class="success round s margin-0">
            <span class="material-icons">person_add</span>
        </button>
    </div>

    <div class="btn-group dopdown dropdown-subjet  padding-0 col-xs-8 col-sm-8 col-md-8 col-lg-8">
        <div id="" type="button" class="dropdown-toggle dropdown-subjet-input" data-toggle="dropdown"
            aria-expanded="true">
            <input autocomplete="off" id="cart_user_input" class="form-control" type="text"
                placeholder="Buscar contacto..">
        </div>
        <ul id="contact_auto_subjet" class="dropdown-menu dropdown-subjet-div">
            
        </ul>
    </div>

    <div class="padding-0 col-xs-2 col-sm-2 col-md-2 col-lg-2">
        <div class="btn-group dropright">
            <button type="button" class="success round s margin-0 dropdown-toggle dropdown-toggle-split"
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <div class="round-icon pr"><span> m </span></div>
            </button>
            <ul class="dropdown-menu pull-right">
                <li class="header">Listas de precios</li>
                <li>
                    <a href="#">
                        <div class="round-icon pr"><span> P </span></div> Lista Pubico
                    </a>
                </li>
                <li>
                    <a href="#">
                        <div class="round-icon pr"><span> m </span></div> Lista Mayorista
                    </a>
                </li>
            </ul>
        </div>
    </div>

</div>

<!-- Cart main module -->
<div class="tabs-main margin-t-10 default col-xs-12 col-sm-12 col-md-12 col-lg-12 padding-0">
    <ul class="nav nav-tabs">
        <li id="cart_item_tab_icon" class="ripple  active">
            <a data-toggle="tab" href="#cart_item_tab">
                <span class="material-icons">shopping_cart</span>
                <span class="cart_n cart-number">0</span>
                {{#with ws_lang_data}} {{t_cart}}{{/with}}
            </a>
        </li>
        <li id="fav_item_tab_icon" class="ripple">
            <a data-toggle="tab" href="#fav_item_tab">
                <span class="material-icons">favorite</span>
                <span class="fav_count">0</span>
                {{#with ws_lang_data}} {{t_fav}}{{/with}}
            </a>
        </li>
        <li id="new_item_tab_icon" class="ripple">
            <a data-toggle="tab" href="#new_item_tab">
                <span class="material-icons">
                    add_circle
                </span>
                {{#with ws_lang_data}} {{t_new_product}}{{/with}}
            </a>
        </li>
    </ul>
    <!--tab-content--->
    <div class="tab-content ">
        <!--tab--->
        <div id="cart_item_tab" class="tab-pane fade in active">
            <!--s-card-activ-cont--->
            <div id="product_cart_items" class="s-card-activ-cont gray">
            </div>
        </div>
        <div id="fav_item_tab" class="tab-pane fade in">
            <div id="product_fav_items" class="s-card-activ-cont gray">
            </div>
        </div>
        <div id="new_item_tab" class="tab-pane fade in">
            <div id="product_new_product" class="s-card-activ-cont gray">
            </div>
        </div>
        <!--tab-content--->
    </div>
    <!--tabs-main--->
</div>

<!-- Cart footer module -->
<div id="cart_footer">
    <div class="s-card-activ-footer b-tiket">
        <div id="cart_total_items">
            <div class="panel-group " id="accordion" role="tablist" aria-multiselectable="true">
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="headingOne">
                        <h4 class="panel-title">
                            <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne"
                                aria-expanded="true" aria-controls="collapseOne">
                                <div class="row">
                                    <h3 class="col-xs-6 col-sm-6 col-md-6 col-lg-6 text-left">
                                        <span class="material-icons">
                                            arrow_drop_down_circle
                                        </span>

                                        {{#with ws_lang_data}} {{t_total}}{{/with}}

                                    </h3>
                                    <h3 class="col-xs-6 col-sm-6 col-md-6 col-lg-6 text-right">
                                        {{#with ws_info}} {{money}}{{/with}}
                                        <span id="total_cart_neto">
                                            0
                                        </span>
                                    </h3>
                                </div>
                            </a>
                        </h4>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
                        <div class="panel-body">
                            <div class="row">
                                <h4 class="col-xs-6 col-sm-6 col-md-6 col-lg-6 text-left">
                                    {{#with ws_lang_data}} {{t_service}}{{/with}}:
                                </h4>
                                <h4 class="col-xs-6 col-sm-6 col-md-6 col-lg-6 text-right">
                                    {{#with ws_info}} {{money}}{{/with}}
                                    <span id="total_neto_service">0</span>
                                </h4>
                            </div>
                            <div class="row ">
                                <h4 class="col-xs-6 col-sm-6 col-md-6 col-lg-6 text-left">
                                    {{#with ws_lang_data}} {{t_product}}{{/with}}:
                                </h4>
                                <h4 class="col-xs-6 col-sm-6 col-md-6 col-lg-6 text-right">
                                    {{#with ws_info}} {{money}}{{/with}}


                                    <span iid="total_neto_prod">0</span>
                                </h4>
                            </div>
                            <div class="row text-red">
                                <h4 class="col-xs-6 col-sm-6 col-md-6 col-lg-6 text-left">
                                    {{#with ws_lang_data}} {{t_dicount}}{{/with}}:
                                </h4>
                                <h4 class="col-xs-6 col-sm-6 col-md-6 col-lg-6 text-right">
                                    {{#with ws_info}} {{money}}{{/with}}
                                    <span id="total_neto_discount">0</span>
                                </h4>
                            </div>
                            <div class="row text-red">
                                <h4 class="col-xs-6 col-sm-6 col-md-6 col-lg-6 text-left">
                                    {{#with ws_lang_data}} {{t_tax}}{{/with}}

                                </h4>
                                <h4 class="col-xs-6 col-sm-6 col-md-6 col-lg-6 text-right">
                                    {{#with ws_info}} {{#each tax}} {{tax_name}} (% {{tax_value}}) {{/each}}{{/with}}
                                    <span id="total_neto_tax">0</span>
                                </h4>
                            </div>
                            <div class="row text-green">
                                <h4 class="col-xs-6 col-sm-6 col-md-6 col-lg-6 text-left">
                                    {{#with ws_lang_data}} {{t_pay}}{{/with}}:

                                </h4>
                                <h4 class="col-xs-6 col-sm-6 col-md-6 col-lg-6 text-right">
                                    {{#with ws_info_}} {{money}}{{/with}}:
                                    <span id="total_neto_pay">0</span>
                                </h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--div class="btn-group margin-t-10 col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <label>Informe al cliente</label><small> (Se muestra al cliente)</small>
            <input class="form-control" type="textarea" placeholder="Escribe el informe al cliente...">
        </div-->
    <div class="text-center margin-t-10 col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <!--button type="button" class="btn btn-primary"><span class="material-icons"> print </span> Imprimir </button-->
        <button onclick="new_order(this)" category_id="sell" type="button" class="cobrar-btn btn btn-primary">
            <span class="material-icons">monetization_on</span>
            {{#with ws_lang_data}} {{b_add_order}}{{/with}}
        </button>
    </div>
</div>


<script id="contact_search_item_templateNO2" type="text/x-handlebars-template">
  
       {{#each this}}
            <li class="margin-5">
                <a contact_id="" class="" role="button" data-toggle="tooltip" data-placement="top"
                    data-original-title="">
                    <div class="s-card-mini-img col-xs-2 col-sm-2 col-md-2 col-lg-2">
                        <div class="round-icon user m"><span> </span></div>
                    </div>
                    <div class="s-card-actv-item-prod col-xs-10 col-sm-10 col-md-10 col-lg-10">
                        <div class="s-card-actv-item-name">
                            {{item.contact_first_name}}
                        </div>
                        <div class="s-card-actv-item-name"></div>
                        <div class="s-card-actv-item-name"></div>
                    </div>
                </a>
            </li>
        {{/each}}
 
</script>
<script id="contact_search_item_templateOLNO" type="text/x-handlebars-template">
  
       {{#each this}}
            <li class="margin-5">
                <a contact_id="{{{item._id}}}" class="" role="button" data-toggle="tooltip" data-placement="top"
                    data-original-title="{{item.address}} {{item.address_number}} {{item.address_floor}}{{item.address_state}}{{item.address_country}}">
                    <div class="s-card-mini-img col-xs-2 col-sm-2 col-md-2 col-lg-2">
                        <div class="round-icon user m"><span> {{item.contact_last_name}} </span></div>
                    </div>
                    <div class="s-card-actv-item-prod col-xs-10 col-sm-10 col-md-10 col-lg-10">
                        <div class="s-card-actv-item-name">
                            {{item.contact_first_name}}{{item.contact_last_name}}
                        </div>
                        <div class="s-card-actv-item-name">{{item.document_number}}</div>
                        <div class="s-card-actv-item-name">{{item.phone}}</div>
                    </div>
                </a>
            </li>
        {{/each}}
 
</script>

<script id="contact_search_item_template" type="text/x-handlebars-template">
    <li class="margin-5">
        <a contact_id="{{item._id}}" class="" role="button" data-toggle="tooltip" data-placement="top"
            data-original-title="{{item.address}} {{item.address_number}} {{item.address_floor}}{{item.address_state}}{{item.address_country}}">
            <div class="s-card-mini-img col-xs-2 col-sm-2 col-md-2 col-lg-2">
                <div class="round-icon user m"><span>{{item.contact_last_name}}</span></div>
            </div>
            <div class="s-card-actv-item-prod col-xs-10 col-sm-10 col-md-10 col-lg-10">
                <div class="s-card-actv-item-name">
                    {{item.contact_first_name}}{{item.contact_last_name}}
                </div>
                <div class="s-card-actv-item-name">{{item.document_number}}</div>
                <div class="s-card-actv-item-name">{{item.contact_phone}}</div>
            </div>
        </a>
    </li>
</script>

<script>
// Este es tu método de búsqueda asíncrono
async function searchContacts(query) {
    try {

        const contact_search_options = {
            includeScore: true,
            keys: ['contact_first_name', 'contact_last_name', 'document_number', 'phone']
        };
        let contact_search_fuse;
        // Obtén todos los documentos que comienzan con 'contact_'
        const allDocs = await L_contact_db.allDocs({ 
            include_docs: true,
            startkey: 'contact_',
            endkey: 'contact_\ufff0'
        });
        console.log('AllDOCS',allDocs);
        // Crea una nueva instancia de Fuse con los documentos obtenidos
        contact_search_fuse = new Fuse(allDocs.rows.map(row => row.doc), contact_search_options);

      
        // Haz la búsqueda con Fuse
        const data = contact_search_fuse.search(query);
        /*
        // Renderiza los resultados con Handlebars
        const source = document.querySelector('#contact_search_item_template').innerHTML;
        const template = Handlebars.compile(source);
        const html = template({ user_data: result });
        // Inserta el HTML en tu contenedor
        console.log("RESULT SEARCH CONTACT", result);
        console.log("html template", html);
        document.querySelector('#contact_auto_subjet').innerHTML = html;
        */


        // Obtiene una referencia al contenedor
     /*   const contactListContainer = document.querySelector('#contact_auto_subjet');
        // Renderiza los resultados con Handlebars
        const source = document.querySelector('#contact_search_item_template').innerHTML;
        const template = Handlebars.compile(source);
        const html = template(result);
    */
        const source = document.querySelector('#contact_search_item_template').innerHTML;
        const template = Handlebars.compile(source);
        const html = template(data);
        document.querySelector('#contact_auto_subjet').innerHTML = html;



        //console.log("RESULT SEARCH CONTACT", result);
      //  console.log("html template", html);
        // Reemplaza todo el contenido del contenedor con el HTML generado por Handlebars
       // contactListContainer.innerHTML = html;

    } catch (error) {
        // Muestra el error en un Snackbar
        Snackbar.show({
            text: 'Hubo un error en la búsqueda: ' + error.message,
            actionText: 'ok',
            actionTextColor: "#0575e6",
        });
    }
}

// Añade un event listener al input para que realice la búsqueda cada vez que cambie
document.querySelector('#cart_user_input').addEventListener('input', (event) => {
    searchContacts(event.target.value);
});


</script>

