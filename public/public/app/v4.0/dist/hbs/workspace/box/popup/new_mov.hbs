<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.13/css/intlTelInput.css">
{{#with ws_lang_data }}
<div class="modal-dialog modal-xs" role="document">
    <div class="modal-content">
        <form id="new_mov_form" class="">
            <div class="modal-header">
                <div class="modal-nav">
                    <span class="back-arrow btn-previus">
                        <span class="material-icons">arrow_back</span>
                    </span>
                    <span class="modal-title">
                        Registrar <small>Movimiento</small>
                    </span>
                </div>
            </div>
            <div id="modal-body" class="">
                <div class="modal-body padding-10 text-left col-sm-12 col-md-12 col-xs-12">

                    <div id="">
                        <div class="form-group text-center col-lg-6 col-md-6 col-sm-6 col-xs-12">
                            <div class="btn-group">
                                <button type="button" id="movimiento-btn"
                                    class="btn xl btn-more btn-primary line dropdown-toggle" data-toggle="dropdown"
                                    aria-expanded="true">
                                    <span id="movimiento-icon" class="material-icons">add_circle_outline</span>
                                    <span id="movimiento-text" class="hidden-xs hidden-sm">Tipo de movimiento</span>
                                </button>
                                <ul class="dropdown-menu pull-right">
                                    <li role="separator" class="divider"></li>
                                    <li><a onclick="add_new_mov_select_type(this)" href="#" data-icon="money_off"
                                            data-text="Gasto"><i class="material-icons">money_off</i>Gasto</a></li>
                                    <li><a onclick="add_new_mov_select_type(this)" href="#" data-icon="attach_money"
                                            data-text="Ingreso"><i class="material-icons">attach_money</i>Ingreso</a>
                                    </li>
                                    <li role="separator" class="divider"></li>
                                    <li><a onclick="add_new_mov_select_type(this)" href="#" data-icon="money"
                                            data-text="Retiro efectivo"><i class="material-icons">money</i>Retiro
                                            efectivo</a></li>
                                    <li><a onclick="add_new_mov_select_type(this)" href="#" data-icon="point_of_sale"
                                            data-text="Efectivo al cierre"><i
                                                class="material-icons">point_of_sale</i>Cierre de CAJA</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="form-group text-center col-lg-6 col-md-6 col-sm-6 col-xs-12">
                            <div class="btn-group">
                                <button type="button" id="movimiento-btn"
                                    class="btn xl btn-more btn-primary line dropdown-toggle" data-toggle="dropdown"
                                    aria-expanded="true">
                                    <span id="movimiento-icon_payment" class="material-icons">account_balance_wallet
                                    </span>
                                    <span id="movimiento-text_payment" class="hidden-xs hidden-sm">Medio de pago</span>
                                </button>
                                <ul class="dropdown-menu pull-right">
                                    <li role="separator" class="divider"></li>
                                    {{#each ../payment_type_list as | pl |}}
                                    <li><a onclick="add_new_mov_select_type_payment(this)" href="#" data-icon="{{icon}}"
                                            data-text="{{name}}"><i class="material-icons">{{icon}}</i>{{name}}</a></li>
                                    {{/each}}
                                    <li role="separator" class="divider"></li>
                                </ul>
                            </div>
                        </div>
                         <div class="form-group col-lg-6 col-md-6 col-sm-6 col-xs-12">
                            <label>Descripcion <small></small></label>
                            <div class="input-group">
                                <div class="input-group-addon">
                                    <i class="maxi" aria-hidden="true">
                                        <strong style="font-size: 30px; font-style: normal;"><i
                                                class="material-icons">request_quote</i> </strong>
                                    </i>
                                </div>
                                <input class="form-control maxi money round-r" id="new_mov_description"
                                    name="new_mov_description" value="" name="valor">
                            </div>
                        </div>
                        <div class="form-group col-lg-6 col-md-6 col-sm-6 col-xs-12">
                            <label>Valor</label>
                            <div class="input-group">
                                <div class="input-group-addon">
                                    <i class="maxi" aria-hidden="true">
                                        <strong style="font-size: 30px; font-style: normal;">$</strong>
                                    </i>
                                </div>
                                <input class="form-control maxi money round-r" type="number" id="new_mov_value" value=""
                                    name="valor">
                            </div>
                        </div>
                       


                    </div>

                </div>
            </div>
    </div>

    <div class="modal-footer col-sm-12 col-md-12 col-xs-12">
        <button type="button" class="btn-previus btn btn-default" data-dismiss="modal" aria-label="Close">
            <span class="">{{b_cancel}}</span>
        </button>
        <button id="" onclick="new_mov_pay(this)" category_id="new_mov" type="button"
            class="btn btn-primary ">
            <span class="">{{b_save}}</span>
        </button>
    </div>
    </form>
</div>
{{/with}}
<!--link href="/public/app/v4.0/plugins/iCheck/square/blue.css" rel="stylesheet">
<script src="/public/app/v4.0/plugins/iCheck/icheck.min.js"></script-->

<script>

    function save_new_mov() {
        // Recoge los mensajes desde los atributos de los campos
        const first_name_msj = $("#first_name").attr('data-msg-required');
        const last_name_msj = $("#last_name").attr('data-msg-required');
        const document_number_msj = $("#document_number").attr('data-msg-required');
        const email_msj = $("#email").attr('data-msg-required');
        const phone_msj = $("#phone").attr('data-msg-required');
        const phone_min_msj = $("#phone").attr('data-msg-minlength');

        // Define las reglas y mensajes de validación en una sola llamada a validate
        $("#new_mov_form").validate({
            ignore: [],
            rules: {
                first_name: {
                    required: true
                },
                last_name: {
                    required: true
                }
            },
            messages: {
                first_name: {
                    required: first_name_msj
                },
                last_name: {
                    required: last_name_msj
                }
            }
        });

        // Solo si el formulario es válido, recoger los datos y enviarlos
        if ($("#new_mov_form").valid()) {
            // Obtener todos los elementos de entrada y select dentro del formulario
            const inputs = document.querySelectorAll('#new_mov_form input, #new_mov_form select');
            let formData = {};
            // Recorrer todos los elementos
            for (let i = 0; i < inputs.length; i++) {
                const input = inputs[i];
                // Agregar el valor del elemento al objeto formData utilizando su id como clave
                formData[input.id] = input.value;
            }
            // Convertir el objeto formData en una cadena JSON y devolverla
            console.log('save_new_mov', formData);
            new_contact_put(formData);
            return true
        } else {
            return false;
        }
    }

    function add_new_mov_select_type(element) {
        // Obtener el icono y el texto de la opción seleccionada
        var icon = element.getAttribute('data-icon');
        var text = element.getAttribute('data-text');
        // Actualizar el contenido del botón
        document.getElementById('movimiento-icon').textContent = icon;
        document.getElementById('movimiento-text').textContent = text;
    }


    function add_new_mov_select_type_payment(element) {
        // Obtener el icono y el texto de la opción seleccionada
        var icon = element.getAttribute('data-icon');
        var text = element.getAttribute('data-text');
        // Actualizar el contenido del botón
        document.getElementById('movimiento-icon_payment').textContent = icon;
        document.getElementById('movimiento-text_payment').textContent = text;
        document.getElementById('new_mov_description').focus();
        // document.getElementById('new_mov_value').focus();


    }

</script>